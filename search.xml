<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>EC_POAF_dataset</title>
    <url>/2022/07/10/EC-POAF-dataset/</url>
    <content><![CDATA[<h1 id="Meta-analysis-of-risk-factors-and-complications-associated-with-atrial-fibrillation-after-oesophagectomy"><a href="#Meta-analysis-of-risk-factors-and-complications-associated-with-atrial-fibrillation-after-oesophagectomy" class="headerlink" title="Meta-analysis of risk factors and complications associated with atrial fibrillation after oesophagectomy"></a>Meta-analysis of risk factors and complications associated with atrial fibrillation after oesophagectomy</h1><p><img src="https://s2.loli.net/2022/07/10/y3Uph1TgeVKfASD.png" alt="Snipaste_2022-07-10_20-16-27.png"></p>
<p><a href="https://academic.oup.com/bjs/article/106/5/534/6092842?login=true#supplementary-data">https://academic.oup.com/bjs/article/106/5/534/6092842?login=true#supplementary-data</a> <span id="more"></span></p>
<p>In total, 53 studies including 9087 patients were eligible for analysis. The overall incidence of postoperative AF was 16⋅5 per cent. Coronary artery disease and hypertension were associated with AF , whereas diabetes, smoking and chronic obstructive pulmonary disease were not. Patients with AF had a significantly higher risk of overall postoperative adverse events than those without fibrillation (odds ratio (OR) 5⋅50, 95 per cent c.i. 3⋅51 to 8⋅30), including 30-day mortality (OR 2⋅49, 1⋅70 to 3⋅64), anastomotic leak (OR 2⋅65, 1⋅53 to 4⋅59) and pneumonia (OR 3⋅42, 2⋅39 to 4⋅90).</p>
<h2 id="Risk-factors-of-atrial-fibrillation-occurring-after-radical-surgery-of-esophageal-carcinoma"><a href="#Risk-factors-of-atrial-fibrillation-occurring-after-radical-surgery-of-esophageal-carcinoma" class="headerlink" title="Risk factors of atrial fibrillation occurring after radical surgery of esophageal carcinoma"></a>Risk factors of atrial fibrillation occurring after radical surgery of esophageal carcinoma</h2><p><img src="https://s2.loli.net/2022/07/10/gNQ35R29eCtvqMj.png" alt="Snipaste_2022-07-10_20-20-32.png"></p>
<p><a href="https://cardiothoracicsurgery.biomedcentral.com/articles/10.1186/s13019-019-0885-z">Risk factors of atrial fibrillation occurring after radical surgery of esophageal carcinoma | Journal of Cardiothoracic Surgery | Full Text (biomedcentral.com)</a></p>
<p>Ji-bin Lu,  Correspondence: <a href="mailto:&#x79;&#117;&#x6e;&#101;&#114;&#51;&#48;&#50;&#x31;&#x40;&#x73;&#x69;&#110;&#x61;&#x2e;&#x63;&#111;&#x6d;">&#x79;&#117;&#x6e;&#101;&#114;&#51;&#48;&#50;&#x31;&#x40;&#x73;&#x69;&#110;&#x61;&#x2e;&#x63;&#111;&#x6d;</a></p>
<p>Of the 335 patients with esophageal cancer, 48 had AF within one week after operation. Univariate analysis indicated that the age (OR: 4 . 8 9 ; CI: 2 . 5 3–9.47, P: 0.000), gender (OR: 2 . 2 6 ; CI: 1 . 1 7–4.37, P: 0.013), history of peripheral vascular disease (OR: 2 . 2 9 ; CI: 1 . 0 6–4.92, P: 0.030), history of cardiac stents or angina pectoris (OR: 2 7 . 3 0 ; CI: 1 2 . 4 4–59.91, P: 0.000), preoperative BNP level (OR: 2 7 . 1 3 ; CI: 1 0 . 9 7–67.06, P: 0.000), preoperative left ventricular diastolic dysfunction (OR: 2 . 2 2 ; CI: 1 . 1 9–4.14, P: 0.012), operative method (OR: 2 . 0 9 ; CI: 1 . 0 0 2–4.380, P: 0.046), intraoperative blood transfusion (OR: 2 0 . 2 4 ; CI: 8 . 3 9–48.82, P: 0.000), and adhesion between lymph nodes and pericardium were risk factors (OR: 2 . 0 5 ; CI: 1 . 0 8–3.87, P: 0.024). Furthermore, multivariate analysis displayed that advanced age (OR: 5 . 0 4 4 ; CI: 1 . 7 4 8–14.554, P: 0 . 003), male (OR: 6 . 1 6 1 ; CI: 2 . 1 4 3–17 .715, P: 0.001), history of cardiac stents or angina pectoris (OR: 48.813; CI: 1 3 . 6 7 4–174. 246, P: 0.000), preoperative BNP &gt; 100 (OR: 41.515; CI: 9 . 3 8 0–183.732, P: 0.000), open surgery (OR: 3 . 3 5 7 ; CI: 1 . 0 2 6–10.983, P: 0.045), intraoperative blood transfusion (OR: 58.404; CI: 1 0 . 7 7 7–316.509, P: 0.000), and adhesion between lymph nodes and pericardium (OR: 3 . 9 5 4 ; CI: 1 . 3 6 4–11.459, P: 0.011) were risk factors which could increase the incidence of postoperative AF.</p>
<p><img src="https://s2.loli.net/2022/07/10/mj8iIfYDvhFB5Xn.png" alt="Snipaste_2022-07-10_20-24-40.png"></p>
<h2 id="Age-and-neo-adjuvant-chemotherapy-increase-the-risk-of-atrial-fibrillation-following-oesophagectomy"><a href="#Age-and-neo-adjuvant-chemotherapy-increase-the-risk-of-atrial-fibrillation-following-oesophagectomy" class="headerlink" title="Age and neo-adjuvant chemotherapy increase the risk of atrial fibrillation following oesophagectomy"></a>Age and neo-adjuvant chemotherapy increase the risk of atrial fibrillation following oesophagectomy</h2><p><img src="https://s2.loli.net/2022/07/10/EHX2qfesOkwQ6Ib.png" alt="Snipaste_2022-07-10_20-19-13.png"></p>
<p><a href="https://academic.oup.com/ejcts/article/42/3/438/404705?login=true">https://academic.oup.com/ejcts/article/42/3/438/404705?login=true</a></p>
<p>Vinay P. Rao,  e-mail: <a href="mailto:&#118;&#x69;&#x6e;&#97;&#121;&#112;&#114;&#x61;&#x6f;&#x40;&#104;&#x6f;&#x74;&#x6d;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#x6d;">&#118;&#x69;&#x6e;&#97;&#121;&#112;&#114;&#x61;&#x6f;&#x40;&#104;&#x6f;&#x74;&#x6d;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#x6d;</a> (V.P. Rao).</p>
<p>Data were extracted from a database of patients who underwent oesophagectomy between 1991 and 2009. Patients with pre-operative arrhythmias were excluded leaving 997 patients for further analysis. Univariate and multivariate logistic regression analyses were performed to identify factors predicting AF, and receiver operating characteristic curves were generated from a model using these predictors. Statistical significance was reflected in a P-value of &lt;0.05.</p>
<p>Despite the identification of age and neo-adjuvant chemotherapy as predictors of AF, the moderate discriminative ability of predictive modelling does not support the use of prophylactic anti-arrhythmic drugs. However, the high incidence of AF after major thoracic surgery makes it necessary to understand its underlying mechanisms better before prophylactic strategies are considered.</p>
<p><img src="https://s2.loli.net/2022/07/10/jULeqz3C9yOoBPI.png" alt="Snipaste_2022-07-10_20-18-16.png"></p>
]]></content>
      <categories>
        <category>POAF_EC</category>
      </categories>
      <tags>
        <tag>POAF_EC</tag>
        <tag>data</tag>
      </tags>
  </entry>
  <entry>
    <title>R_coding</title>
    <url>/2022/07/10/R-coding/</url>
    <content><![CDATA[<h2 id="R-命令"><a href="#R-命令" class="headerlink" title="R 命令"></a>R 命令</h2><h4 id="包的安装"><a href="#包的安装" class="headerlink" title="包的安装"></a>包的安装</h4><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;***&quot;</span><span class="punctuation">)</span></span><br><span class="line">install.packages <span class="punctuation">(</span><span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span>repos<span class="operator">=</span><span class="string">&quot;http://mirror.bjtu.edu.cn/ &quot;</span><span class="punctuation">)</span></span><br><span class="line">BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&#x27;SingleCellExperiment&#x27;</span><span class="punctuation">)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;Japrin/sscClust&quot;</span><span class="punctuation">)</span></span><br><span class="line">.libPaths<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#包的位置</span></span><br><span class="line">installed.packages<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#查看你已经安装了哪些包。</span></span><br><span class="line">available.packages<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#可以查看自己的机器可以安装哪些包</span></span><br></pre></td></tr></table></figure>

<h3 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存<span id="more"></span></h3><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">save.image<span class="punctuation">(</span>file <span class="operator">=</span> <span class="string">&quot;test.RData&quot;</span><span class="punctuation">)</span>    <span class="comment">#保存当前所有变量</span></span><br><span class="line">save<span class="punctuation">(</span>mouse<span class="punctuation">,</span> file <span class="operator">=</span> <span class="string">&quot;test.RData&quot;</span><span class="punctuation">)</span>   <span class="comment">#保存其中一个变量</span></span><br><span class="line">load<span class="punctuation">(</span>mouse.RData<span class="punctuation">)</span>  <span class="comment">#使用时加载命令</span></span><br></pre></td></tr></table></figure>

<h3 id="提取指定亚群"><a href="#提取指定亚群" class="headerlink" title="提取指定亚群"></a>提取指定亚群</h3><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">cd4_sce1 <span class="operator">=</span> sce<span class="punctuation">[</span><span class="punctuation">,</span>sce<span class="operator">@</span>meta.data<span class="operator">$</span>seurat_clusters <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">cd4_sce2 <span class="operator">=</span> sce<span class="punctuation">[</span><span class="punctuation">,</span> Idents<span class="punctuation">(</span>sce<span class="punctuation">)</span> <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span> <span class="string">&quot;Naive CD4 T&quot;</span> <span class="punctuation">,</span>  <span class="string">&quot;Memory CD4 T&quot;</span> <span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment"># subset 函数也可以</span></span><br></pre></td></tr></table></figure>

<h3 id="Seurat-对象输出"><a href="#Seurat-对象输出" class="headerlink" title="Seurat 对象输出"></a>Seurat 对象输出</h3><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>data.table<span class="punctuation">)</span></span><br><span class="line">y <span class="operator">=</span> GetAssayData<span class="punctuation">(</span>object <span class="operator">=</span> object<span class="punctuation">,</span> slot <span class="operator">=</span> <span class="string">&quot;scale.data&quot;</span><span class="punctuation">)</span></span><br><span class="line">data_to_write_out <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>as.matrix<span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">fwrite<span class="punctuation">(</span>x <span class="operator">=</span> data_to_write_out<span class="punctuation">,</span> file <span class="operator">=</span> <span class="string">&quot;outfile.csv&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="write-table"><a href="#write-table" class="headerlink" title="write.table"></a>write.table</h3><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">Usage</span><br><span class="line">write.table<span class="punctuation">(</span>x<span class="punctuation">,</span> file <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> append <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot; &quot;</span><span class="punctuation">,</span></span><br><span class="line">            eol <span class="operator">=</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">,</span> na <span class="operator">=</span> <span class="string">&quot;NA&quot;</span><span class="punctuation">,</span> dec <span class="operator">=</span> <span class="string">&quot;.&quot;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">            col.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> qmethod <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;escape&quot;</span><span class="punctuation">,</span> <span class="string">&quot;double&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            fileEncoding <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line">write.csv<span class="punctuation">(</span>...<span class="punctuation">)</span></span><br><span class="line">write.csv2<span class="punctuation">(</span>...<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="两组差异基因的寻找"><a href="#两组差异基因的寻找" class="headerlink" title="两组差异基因的寻找"></a>两组差异基因的寻找</h3><p><a href="https://blog.csdn.net/FightingBob/article/details/104814298">https://blog.csdn.net/FightingBob/article/details/104814298</a></p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>limma<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>edgeR<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>statmod<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">targets <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>read.csv<span class="punctuation">(</span><span class="string">&quot;F:/公众号/图文素材/运用limma对基因进行差异分析/limma_data.csv&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#行为细胞名，列为基因名</span></span><br><span class="line">group <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;C1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;C2&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">56</span><span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">83</span><span class="punctuation">)</span> <span class="comment">#C1是未突变组，C2是突变组 C1=56 C1+C2=83</span></span><br><span class="line">dgelist <span class="operator">&lt;-</span> DGEList<span class="punctuation">(</span>counts <span class="operator">=</span> targets<span class="punctuation">,</span> group <span class="operator">=</span> group<span class="punctuation">)</span></span><br><span class="line">keep <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>cpm<span class="punctuation">(</span>dgelist<span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">1</span> <span class="punctuation">)</span> <span class="operator">&gt;=</span> <span class="number">2</span> <span class="comment">#过滤</span></span><br><span class="line">dgelist <span class="operator">&lt;-</span> dgelist<span class="punctuation">[</span>keep<span class="punctuation">,</span> <span class="punctuation">,</span>keep.lib.sizes <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">]</span></span><br><span class="line">dgelist_norm <span class="operator">&lt;-</span> calcNormFactors<span class="punctuation">(</span>dgelist<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;TMM&#x27;</span><span class="punctuation">)</span>  <span class="comment">#TMM标准化</span></span><br><span class="line">design <span class="operator">&lt;-</span> model.matrix<span class="punctuation">(</span><span class="operator">~</span>group<span class="punctuation">)</span>    <span class="comment">#构建分组矩阵</span></span><br><span class="line">dge <span class="operator">&lt;-</span> estimateDisp<span class="punctuation">(</span>dgelist_norm<span class="punctuation">,</span> design<span class="punctuation">,</span> robust <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment">#估算离散值</span></span><br><span class="line"><span class="comment">#差异分析</span></span><br><span class="line">fit <span class="operator">&lt;-</span> glmFit<span class="punctuation">(</span>dge<span class="punctuation">,</span> design<span class="punctuation">,</span> robust <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span>     <span class="comment">#拟合模型</span></span><br><span class="line">lrt <span class="operator">&lt;-</span> glmLRT<span class="punctuation">(</span>fit<span class="punctuation">)</span>   <span class="comment">#统计检验</span></span><br><span class="line">topTags<span class="punctuation">(</span>lrt<span class="punctuation">)</span></span><br><span class="line">write.csv<span class="punctuation">(</span>topTags<span class="punctuation">(</span>lrt<span class="punctuation">,</span> n <span class="operator">=</span> nrow<span class="punctuation">(</span>dgelist<span class="operator">$</span>counts<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27; F:/公众号/图文素材/运用limma对基因进行差异分析/glmLRT.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="comment">#输出主要结果</span></span><br></pre></td></tr></table></figure>

<h3 id="火山图"><a href="#火山图" class="headerlink" title="火山图"></a>火山图</h3><p><a href="https://blog.csdn.net/FightingBob/article/details/106161956">https://blog.csdn.net/FightingBob/article/details/106161956</a></p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">diff_stat <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;F:/公众号/图文素材/绘制火山图&amp;热图/data.csv&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">diff_stat<span class="punctuation">[</span>which<span class="punctuation">(</span>diff_stat<span class="operator">$</span>FDR <span class="operator">&lt;</span> <span class="number">0.05</span> <span class="operator">&amp;</span> diff_stat<span class="operator">$</span>logFC <span class="operator">&gt;=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;diff&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;up&#x27;</span> <span class="comment">#上调趋势筛选</span></span><br><span class="line">diff_stat<span class="punctuation">[</span>which<span class="punctuation">(</span>diff_stat<span class="operator">$</span>FDR <span class="operator">&lt;</span> <span class="number">0.05</span> <span class="operator">&amp;</span> diff_stat<span class="operator">$</span>logFC <span class="operator">&lt;=</span> <span class="operator">-</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;diff&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;dowm&#x27;</span> <span class="comment">#下调趋势筛选</span></span><br><span class="line">diff_stat<span class="punctuation">[</span><span class="operator">!</span><span class="punctuation">(</span>diff_stat<span class="operator">$</span>diff <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dowm&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;diff&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>diff_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> logFC<span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>FDR<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> diff<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dowm&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray40&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Enriched OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Depleted OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;No diff OTUs&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2 Fold Change&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;-log10 FDR p-value&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#meihua </span></span><br><span class="line">p1 <span class="operator">&lt;-</span> p1 <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span><span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.2</span><span class="punctuation">,</span> <span class="number">0.9</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="拟时轨迹-monocle2"><a href="#拟时轨迹-monocle2" class="headerlink" title="拟时轨迹 monocle2"></a>拟时轨迹 monocle2</h3><p><a href="https://www.jianshu.com/p/5d6fd4561bc0">https://www.jianshu.com/p/5d6fd4561bc0</a></p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>monocle<span class="punctuation">)</span></span><br><span class="line">pbmc <span class="operator">&lt;-</span> readRDS<span class="punctuation">(</span><span class="string">&quot;pbmc.rds&quot;</span><span class="punctuation">)</span> <span class="comment">#导入注释好的seurat对象（已注释）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##提取表型信息--细胞信息(建议载入细胞的聚类或者细胞类型鉴定信息、实验条件等信息)</span></span><br><span class="line">expr_matrix <span class="operator">&lt;-</span> as<span class="punctuation">(</span>as.matrix<span class="punctuation">(</span>pbmc<span class="operator">@</span>assays<span class="operator">$</span>RNA<span class="operator">@</span>counts<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;sparseMatrix&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">##提取表型信息到p_data(phenotype_data)里面 </span></span><br><span class="line">p_data <span class="operator">&lt;-</span> pbmc<span class="operator">@</span>meta.data </span><br><span class="line">p_data<span class="operator">$</span>celltype <span class="operator">&lt;-</span> pbmc<span class="operator">@</span>active.ident  <span class="comment">##整合每个细胞的细胞鉴定信息到p_data里面。如果已经添加则不必重复添加</span></span><br><span class="line"><span class="comment">##提取基因信息 如生物类型、gc含量等</span></span><br><span class="line">f_data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>gene_short_name <span class="operator">=</span> row.names<span class="punctuation">(</span>pbmc<span class="punctuation">)</span><span class="punctuation">,</span>row.names <span class="operator">=</span> row.names<span class="punctuation">(</span>pbmc<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">##expr_matrix的行数与f_data的行数相同(gene number), expr_matrix的列数与p_data的行数相同(cell number)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#构建CDS对象</span></span><br><span class="line">pd <span class="operator">&lt;-</span> new<span class="punctuation">(</span><span class="string">&#x27;AnnotatedDataFrame&#x27;</span><span class="punctuation">,</span> data <span class="operator">=</span> p_data<span class="punctuation">)</span> </span><br><span class="line">fd <span class="operator">&lt;-</span> new<span class="punctuation">(</span><span class="string">&#x27;AnnotatedDataFrame&#x27;</span><span class="punctuation">,</span> data <span class="operator">=</span> f_data<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#将p_data和f_data从data.frame转换AnnotatedDataFrame对象。</span></span><br><span class="line">cds <span class="operator">&lt;-</span> newCellDataSet<span class="punctuation">(</span>expr_matrix<span class="punctuation">,</span></span><br><span class="line">                      phenoData <span class="operator">=</span> pd<span class="punctuation">,</span></span><br><span class="line">                      featureData <span class="operator">=</span> fd<span class="punctuation">,</span></span><br><span class="line">                      lowerDetectionLimit <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span></span><br><span class="line">                      expressionFamily <span class="operator">=</span> negbinomial.size<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#估计size factor和离散度</span></span><br><span class="line">cds <span class="operator">&lt;-</span> estimateSizeFactors<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line">cds <span class="operator">&lt;-</span> estimateDispersions<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#过滤低质量的细胞，若Seurat已经完成细胞过滤，此步可省略</span></span><br><span class="line"><span class="comment">#用表达某基因的细胞的数目对基因进行过滤</span></span><br><span class="line">cds <span class="operator">&lt;-</span> detectGenes<span class="punctuation">(</span>cds<span class="punctuation">,</span> min_expr <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="comment">#这一操作会在fData(cds)中添加一列num_cells_expressed</span></span><br><span class="line">print<span class="punctuation">(</span>head<span class="punctuation">(</span>fData<span class="punctuation">(</span>cds<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#此时有13714个基因</span></span><br><span class="line">expressed_genes <span class="operator">&lt;-</span> row.names<span class="punctuation">(</span>subset<span class="punctuation">(</span>fData<span class="punctuation">(</span>cds<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    num_cells_expressed <span class="operator">&gt;=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#过滤掉在小于10个细胞中表达的基因，还剩11095个基因。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#轨迹定义基因选择及可视化和构建轨迹</span></span><br><span class="line"><span class="comment">##使用seurat选择的高变基因⚠️</span></span><br><span class="line">express_genes <span class="operator">&lt;-</span> VariableFeatures<span class="punctuation">(</span>pbmc<span class="punctuation">)</span></span><br><span class="line">cds <span class="operator">&lt;-</span> setOrderingFilter<span class="punctuation">(</span>cds<span class="punctuation">,</span> express_genes<span class="punctuation">)</span></span><br><span class="line">plot_ordering_genes<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line"><span class="comment">##使用clusters差异表达基因</span></span><br><span class="line">deg.cluster <span class="operator">&lt;-</span> FindAllMarkers<span class="punctuation">(</span>pbmc<span class="punctuation">)</span></span><br><span class="line">express_genes <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>deg.cluster<span class="punctuation">,</span>p_val_adj<span class="operator">&lt;</span><span class="number">0.05</span><span class="punctuation">)</span><span class="operator">$</span>gene</span><br><span class="line">cds <span class="operator">&lt;-</span> setOrderingFilter<span class="punctuation">(</span>cds<span class="punctuation">,</span> express_genes<span class="punctuation">)</span></span><br><span class="line">plot_ordering_genes<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line"><span class="comment">##使用monocle选择的高变基因⚠️</span></span><br><span class="line">disp_table <span class="operator">&lt;-</span> dispersionTable<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line">disp.genes <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>disp_table<span class="punctuation">,</span> mean_expression <span class="operator">&gt;=</span> <span class="number">0.1</span> <span class="operator">&amp;</span> dispersion_empirical <span class="operator">&gt;=</span> <span class="number">1</span> <span class="operator">*</span> dispersion_fit<span class="punctuation">)</span><span class="operator">$</span>gene_id</span><br><span class="line">cds <span class="operator">&lt;-</span> setOrderingFilter<span class="punctuation">(</span>cds<span class="punctuation">,</span> disp.genes<span class="punctuation">)</span></span><br><span class="line">plot_ordering_genes<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#这一步输入的expressed_genes来自于步骤4。</span></span><br><span class="line"><span class="comment">#⚠️⚠️后续分析使用的是该方法</span></span><br><span class="line"><span class="comment">#也可输入seurat筛选出的高变基因：expressed_genes &lt;- VariableFeatures(pbmc) </span></span><br><span class="line">diff <span class="operator">&lt;-</span> differentialGeneTest<span class="punctuation">(</span>cds<span class="punctuation">[</span>expressed_genes<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>fullModelFormulaStr<span class="operator">=</span><span class="string">&quot;~cell_type&quot;</span><span class="punctuation">,</span>cores<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment">#~后面是表示对谁做差异分析的变量，理论上可以为p_data的任意列名</span></span><br><span class="line">head<span class="punctuation">(</span>diff<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##差异表达基因作为轨迹构建的基因,差异基因的选择标准是qval&lt;0.01,decreasing=F表示按数值增加排序</span></span><br><span class="line">deg <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>diff<span class="punctuation">,</span> qval <span class="operator">&lt;</span> <span class="number">0.01</span><span class="punctuation">)</span> <span class="comment">#选出2829个基因</span></span><br><span class="line">deg <span class="operator">&lt;-</span> deg<span class="punctuation">[</span>order<span class="punctuation">(</span>deg<span class="operator">$</span>qval<span class="punctuation">,</span>decreasing<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">head<span class="punctuation">(</span>deg<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##差异基因的结果文件保存</span></span><br><span class="line">write.table<span class="punctuation">(</span>deg<span class="punctuation">,</span>file<span class="operator">=</span><span class="string">&quot;train.monocle.DEG.xls&quot;</span><span class="punctuation">,</span>col.names<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span>row.names<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span><span class="built_in">quote</span><span class="operator">=</span><span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 轨迹构建基因可视化</span></span><br><span class="line">ordergene <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>deg<span class="punctuation">)</span> </span><br><span class="line">cds <span class="operator">&lt;-</span> setOrderingFilter<span class="punctuation">(</span>cds<span class="punctuation">,</span> ordergene<span class="punctuation">)</span>  </span><br><span class="line"><span class="comment">#这一步是很重要的，在我们得到想要的基因列表后，我们需要使用setOrderingFilter将它嵌入cds对象，后续的一系列操作都要依赖于这个list。</span></span><br><span class="line"><span class="comment">#setOrderingFilter之后，这些基因被储存在cds@featureData@data[[&quot;use_for_ordering&quot;]]，可以通过table(cds@featureData@data[[&quot;use_for_ordering&quot;]])查看</span></span><br><span class="line">pdf<span class="punctuation">(</span><span class="string">&quot;train.ordergenes.pdf&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot_ordering_genes<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#出的图黑色的点表示用来构建轨迹的差异基因，灰色表示背景基因。红色的线是根据第2步计算的基因表达大小和离散度分布的趋势(可以看到，找到的基因属于离散度比较高的基因)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#降维</span></span><br><span class="line">cds <span class="operator">&lt;-</span> reduceDimension<span class="punctuation">(</span>cds<span class="punctuation">,</span> max_components <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;DDRTree&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#Step 3: 拟时间轴轨迹构建和在拟时间内排列细胞</span></span><br><span class="line">cds <span class="operator">&lt;-</span> orderCells<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#⚠️使用root_state参数可以设置拟时间轴的根，如下面的拟时间着色图中可以看出，左边是根。根据state图可以看出，根是State1，若要想把另一端设为根，可以按如下操作</span></span><br><span class="line">cds <span class="operator">&lt;-</span> orderCells<span class="punctuation">(</span>cds<span class="punctuation">,</span> root_state <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="comment">#把State5设成拟时间轴的起始点</span></span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">GM_state <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>cds<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>unique<span class="punctuation">(</span>pData<span class="punctuation">(</span>cds<span class="punctuation">)</span><span class="operator">$</span>State<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    T0_counts <span class="operator">&lt;-</span> table<span class="punctuation">(</span>pData<span class="punctuation">(</span>cds<span class="punctuation">)</span><span class="operator">$</span>State<span class="punctuation">,</span> pData<span class="punctuation">(</span>cds<span class="punctuation">)</span><span class="operator">$</span>seurat_clusters<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;0&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="built_in">return</span><span class="punctuation">(</span><span class="built_in">as.numeric</span><span class="punctuation">(</span><span class="built_in">names</span><span class="punctuation">(</span>T0_counts<span class="punctuation">)</span><span class="punctuation">[</span>which</span><br><span class="line">                                       <span class="punctuation">(</span>T0_counts <span class="operator">==</span> <span class="built_in">max</span><span class="punctuation">(</span>T0_counts<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="built_in">return</span> <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">cds <span class="operator">&lt;-</span> orderCells<span class="punctuation">(</span>cds<span class="punctuation">,</span> root_state <span class="operator">=</span> GM_state<span class="punctuation">(</span>cds<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#可视化</span></span><br><span class="line">pdf<span class="punctuation">(</span><span class="string">&quot;cd8.pseudotime.pdf&quot;</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span>height <span class="operator">=</span> <span class="number">7</span><span class="punctuation">)</span></span><br><span class="line">plot_cell_trajectory<span class="punctuation">(</span>cds<span class="punctuation">,</span> color_by<span class="operator">=</span><span class="string">&quot;Pseudotime&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> show_tree <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> show_backbone<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> </span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pdf<span class="punctuation">(</span><span class="string">&quot;cd8.state.pdf&quot;</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span>height <span class="operator">=</span> <span class="number">7</span><span class="punctuation">)</span></span><br><span class="line">plot_cell_trajectory<span class="punctuation">(</span>cds<span class="punctuation">,</span> color_by<span class="operator">=</span><span class="string">&quot;State&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> show_tree <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> show_backbone<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> </span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pdf<span class="punctuation">(</span><span class="string">&quot;cd8.celltype.pdf&quot;</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span>height <span class="operator">=</span> <span class="number">7</span><span class="punctuation">)</span></span><br><span class="line">plot_cell_trajectory<span class="punctuation">(</span>cds<span class="punctuation">,</span> color_by<span class="operator">=</span>Idents<span class="punctuation">(</span>cd8<span class="punctuation">)</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> show_tree <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> show_backbone<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> </span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="颜色渐变"><a href="#颜色渐变" class="headerlink" title="颜色渐变"></a>颜色渐变</h3><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">+</span>scale_color_gradientn<span class="punctuation">(</span>values <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span>ccolours <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#330066&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#336699&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#66CC66&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#FFCC33&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span><span class="comment">#颜色渐变设置</span></span><br></pre></td></tr></table></figure>

<h3 id="excel不覆盖写入"><a href="#excel不覆盖写入" class="headerlink" title="excel不覆盖写入"></a>excel不覆盖写入</h3><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">s<span class="comment">#前面讲过如何加载已有工作簿，这里以生成新excel工作簿为例，将数据写入文件中</span></span><br><span class="line">wb <span class="operator">&lt;-</span> xlsx<span class="operator">::</span>createWorkbook<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">sheets <span class="operator">&lt;-</span> getSheet<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 新生成的工作簿没有sheet，系统提示：Workbook has no sheets!</span></span><br><span class="line">sheet <span class="operator">&lt;-</span> createSheet<span class="punctuation">(</span>wb<span class="punctuation">,</span>sheetName <span class="operator">=</span> <span class="string">&quot;newSheet1&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#此时R内存中已经生成了一个工作簿，包含一个空的sheet工作表，通过addDataFrame()函数将数据写入sheet中.</span></span><br><span class="line"><span class="comment"># 用上面生成的datas数据框对象，取前4行数据写入当前sheet对象中</span></span><br><span class="line">addDataFrame<span class="punctuation">(</span>data<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>sheet<span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">saveWorkbook<span class="punctuation">(</span>wb<span class="punctuation">,</span>file <span class="operator">=</span> <span class="string">&quot;iris_new.xlsx&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果是在已有excel工作簿上操作，这里最好做一个判断，避免覆盖现有数据，造成不必要的麻烦。如果当前sheet的最后一行索引不等于零（说明有数据），则将新数据写到最后一行数据的下一行，同时不加入列名行(col.names = FALSE)；如果为零则将数据直接添加到sheet中。</span></span><br><span class="line"><span class="comment"># 用上面生成的datas数据框对象，取前4行数据写入当前sheet对象中</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span>sheet<span class="operator">$</span>getLastRowNum<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">!=</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">         addDataFrame<span class="punctuation">(</span>data<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>sheet<span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>col.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>startRow <span class="operator">=</span> sheet<span class="operator">$</span>getLastRowNum<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">       <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">         addDataFrame<span class="punctuation">(</span>data<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>sheet<span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">saveWorkbook<span class="punctuation">(</span>wb<span class="punctuation">,</span>file <span class="operator">=</span> <span class="string">&quot;iris_new.xlsx&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="合并seurat对象"><a href="#合并seurat对象" class="headerlink" title="合并seurat对象"></a>合并seurat对象</h3><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#两个对象</span></span><br><span class="line">pbmc.combined <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>pbmc4k<span class="punctuation">,</span> y <span class="operator">=</span> pbmc8k<span class="punctuation">,</span> add.cell.ids <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;4K&quot;</span><span class="punctuation">,</span> <span class="string">&quot;8K&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> project <span class="operator">=</span> <span class="string">&quot;PBMC12K&quot;</span><span class="punctuation">)</span></span><br><span class="line">pbmc.combined</span><br><span class="line"><span class="comment">#合并两个以上</span></span><br><span class="line">pbmc.big <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>pbmc3k<span class="punctuation">,</span> y <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>pbmc4k<span class="punctuation">,</span> pbmc8k<span class="punctuation">)</span><span class="punctuation">,</span> add.cell.ids <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;3K&quot;</span><span class="punctuation">,</span> <span class="string">&quot;4K&quot;</span><span class="punctuation">,</span> <span class="string">&quot;8K&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> project <span class="operator">=</span> <span class="string">&quot;PBMC15K&quot;</span><span class="punctuation">)</span></span><br><span class="line">pbmc.big</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>R_coding</category>
      </categories>
      <tags>
        <tag>R_coding</tag>
        <tag>Single_cell_analysis</tag>
      </tags>
  </entry>
  <entry>
    <title>ask for data</title>
    <url>/2022/07/10/ask-for-data/</url>
    <content><![CDATA[<h1 id="ask-for-data"><a href="#ask-for-data" class="headerlink" title="ask for data"></a>ask for data</h1><p>Hi Professor xxx :</p>
<p>Thank you for reading!<br>I am a doctor in the Department of Thoracic Surgery of the Second Affiliated Hospital of Zhejiang University School of Medicine<br>My research is focused on xxx. I have recently read your paper: “ xxxxx”. The  work was so interesting and it was attractive to me.<br>I am wondering if you could kindly send me the source program, dataset and the necessary information about it. I promise they will be used only for research purposed.<br>      Thank you very much for your kind consideration and I am looking forward to your early reply.</p>
<p>All the best,</p>
]]></content>
  </entry>
</search>
